<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Админка бота</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h1>Управление ботом</h1>
    <button id="setOnlineBtn" class="btn btn-success">Установить время окончания приема демок</button>
    <button id="offlineBtn" class="btn btn-danger">Выключить прием демок</button>

    <!-- Dropdown for selecting chat for stream -->
    <div>
        <select id="chatSelect" class="custom-select">
            <option value="academy_chat">Нейропанк Академия</option>
            <option value="np_pro">PRO (КОНТЕНТ ПО ПОДПИСКЕ)</option>
            <option value="np_basic">НАЧАЛЬНЫЙ #1 - от 0 до паладина!</option>
            <option value="liquid_chat">ЛИКВИД КУРС</option>
            <option value="super_pro">SUPER PRO#1 (DNB)</option>
            <option value="neuro">НЕЙРОФАНК КУРС</option>
            <option value="nerve">NERV3 Продуктивность Level 99 #1</option>
            <option value="girls">DNB Курс - только девушки!</option>
            <option value="zoom">ZOOM #1</option>
        </select>
        <button id="setStreamBtn" class="btn btn-info">Установить чат стрима</button>
    </div>

    <!-- Buttons for fetching emails -->
    <button id="getEmailsNpProBtn" class="btn btn-primary">Получить email'ы NP Pro</button>
    <button id="getEmailsZoomBtn" class="btn btn-primary">Получить email'ы Zoom</button>

    <div id="emailsList"></div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script>
    document.getElementById('setOnlineBtn').addEventListener('click', function() {
        const endTime = prompt("Введите время окончания приема демок в формате YYYY-MM-DDTHH:MM:SS");
        fetch('/api/online', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({end_time: endTime})
        })
        .then(response => response.json())
        .then(data => alert(data.message));
    });

    document.getElementById('offlineBtn').addEventListener('click', function() {
        fetch('/api/offline', {method: 'POST'})
            .then(response => response.json())
            .then(data => alert(data.message));
    });

    document.getElementById('setStreamBtn').addEventListener('click', function() {
        const chatName = document.getElementById('chatSelect').value;
        fetch('/api/stream', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({chat_name: chatName})
        })
        .then(response => response.json())
        .then(data => alert(data.message));
    });

    document.getElementById('getEmailsNpProBtn').addEventListener('click', function() {
        fetchEmails('np_pro');
    });

    document.getElementById('getEmailsZoomBtn').addEventListener('click', function() {
        fetchEmails('zoom');
    });

    function fetchEmails(course) {
        fetch(`/api/emails?course=${course}`)
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    const emailsList = document.getElementById('emailsList');
                    emailsList.innerHTML = '<ul>' + data.emails.map(email => `<li>${email}</li>`).join('') + '</ul>';
                }
            });
    }
</script>
</body>
</html>